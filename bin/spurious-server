#!/usr/bin/env ruby

$: << File.join(File.dirname(__FILE__), '..', 'lib')

require 'spurious/server'
require 'spurious/server/version'
require 'daemons'
require 'eventmachine'
require 'spurious/server/options'

options = Spurious::Server::Options.new(ENV)

Docker.url                     = options.docker_full_path if options.docker_api
Excon.defaults[:write_timeout] = options.write_timeout
Excon.defaults[:read_timeout]  = options.read_timeout

Daemons.run_proc('Spurious Server', :dir => '/tmp', :log_output => true) do
  EventMachine.run Spurious::Server.handle(options)
end
