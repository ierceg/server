#!/usr/bin/env ruby
$: << File.join(File.dirname(__FILE__), "..", "lib")

require 'rack'
require 'spurious/server/app'
require 'optparse'

options = {
  :port => 4571,
  :host => "0.0.0.0",
  :daemonize => false
}

parser = OptionParser.new do |o|

  o.on "-p", "--port PORT", Integer, "Port to use (default: #{options[:port]})" do |port|
    options[:port] = port
  end

  o.on "-o", "--bind HOST", "Host to bind to (default: #{options[:host]})" do |host|
    options[:host] = host
  end

  o.on "-d", "--[no-]daemonize", "Detaches the process" do |daemonize|
    options[:daemonize] = daemonize
  end

  o.on_tail "--version", "Shows the version" do
    puts Spurious::Server::VERSION
    exit
  end

  o.on_tail "-h", "--help", "Shows this help page" do
    puts o
    exit
  end

end

parser.parse!
puts options[:port]

Rack::Handler::WEBrick.run(
  Spurious::Server::App.new(options),
  :Port => options[:port],
  :Bind => options[:bind]
)
